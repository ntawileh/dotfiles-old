#!/usr/bin/env sh
#        â–ˆâ–ˆ
#       â–‘â–ˆâ–ˆ
#      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ
#     â–‘â–‘â–‘â–ˆâ–ˆâ–‘ â–‘â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆ â–ˆâ–ˆ
#       â–‘â–ˆâ–ˆ   â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆ
#       â–‘â–ˆâ–ˆ   â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ  â–ˆâ–ˆâ–‘â–ˆâ–ˆ
#       â–‘â–‘â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆ
#        â–‘â–‘  â–‘â–‘â–‘  â–‘â–‘  â–‘â–‘  â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘   â–‘â–‘
#           â–ˆâ–ˆ               â–ˆâ–ˆ
#          â–‘â–ˆâ–ˆ              â–‘â–ˆâ–ˆ
#  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
# â–ˆâ–ˆâ–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–ˆâ–ˆâ–‘  â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆ â–‘â–‘â–‘â–ˆâ–ˆâ–‘ â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ â–ˆâ–ˆâ–‘â–‘â–‘â–‘
#â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–‘â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
# â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ   â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–ˆâ–ˆ   â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆ
# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–‘â–‘â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–‘â–‘â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
#â–‘â–‘â–‘â–‘â–‘â–‘     â–‘â–‘   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘    â–‘â–‘   â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘â–‘

FULL=â–“
EMPTY=â–‘
EOL=â–’
DEF="default"
C0="colour0"
C1="colour9"
C2="colour10"
C3="colour11"
C4="colour12"
C5="colour13"
C6="colour14"
C7="colour15"
C8="colour252"
C9="colour239"

draw() {
	perc=$1
	SIZE=$2
	inc=$((perc * SIZE / 100))
	out=
	v=0
	while [ "$v" -le $((SIZE - 1)) ]; do
		if [ "$v" -le "$inc" ]; then
			out="$out#[default]#[fg=$C4]${EMPTY}"
		else
			out="$out#[default]#[fg=$C9]${FULL}"
		fi
		v=$((v + 1))
	done
	echo "$out"
}
temp() {
	t=$(sensors | awk '/Core\ 0/ {gsub(/\+/,"",$3); gsub(/\..+/,"",$3)    ; print $3}')
	tc=$C3
	[ "$t" -le 50 ] && tc=$C4
	[ "$t" -ge 75 ] && tc=$C1
	echo "#[bg=$C0,fg=$tc]$tÂ°c"
}
bat() {
	BATPATH=/sys/class/power_supply/BAT0
	capacity=$(cat $BATPATH/capacity)
	status=$(cat $BATPATH/status)
	case $status in
	Full)
		st="ðŸ”‹"
		;;
	Discharging)
		st="ðŸ”‹"
		;;
	Charging)
		st="âš¡"
		;;
	esac
	[ "$capacity" -lt 10 ] && fg=$C1 || fg=$C4
	echo "#[fg=$fg,bg=$C0]$st$capacity%"
}
cpu() {
	CPU_USE=$(grep 'cpu ' /proc/stat | awk '{usage=($2+$4)*100/($2+$4+$5)} END {print usage}')
	printf "%.0f" "$CPU_USE"
}
ram() {
	free | awk '/Mem:/ {print int($3/$2 * 100.0)}'
}
vpn() {
	pgrep openconnect >/dev/null 2>&1 && echo "#[fg=3]VPN"
}
clock() {
	mtime=$(date +'%H:%M')
	myear=$(date +'%b-%e')
	mday=$(date +'%a')
	echo "#[bg=$C0,fg=$C7] $mtime #[fg=$C5]$mday#[fg=$C7] $myear #[default]#[fg=$C0]$EOL"
}
front() {
	echo "#[fg=$C9]â–‘â–’â–“â–ˆ"
}

CPU_INFO=$(cpu)
RAM_INFO=$(ram)
echo "$(front)$(bat) $(draw "$RAM_INFO" 5)$(temp) $(draw "$CPU_INFO" 7)$(vpn)$(clock)"
